<!DOCTYPE html><html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Level Test — by Shin</title>
  <style>
    :root{
      --bg:#F5EED8; /* พื้นหลัง ตามที่ชินขอ */
      --text:#F5E3CB; /* ตัวหนังสือ ตามที่ชินขอ */
      --card:#ffffffcc; /* การ์ดสีอ่อนเพื่อความอ่านง่าย */
      --muted:rgba(0,0,0,0.45);
      --btn:#757575; /* ปุ่ม */
      --good:#22c55e; /* ถูก */
      --bad:#ef4444;  /* ผิด */
      --accent:#b0c4a6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;
      /* ป้องกันการคัดลอกข้อความ */
      -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;
    }
    .wrap{max-width:960px;margin:24px auto;padding:18px}
    .card{background:var(--card); border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.06); color: #2b2b2b}
    h1{font-size:clamp(20px,3vw,30px);margin:4px 0 6px;color:#333}
    p.lead{color:var(--muted);margin:0 0 12px}
    .row{display:grid;gap:12px}
    .row.cols-2{grid-template-columns:1fr}
    @media(min-width:768px){.row.cols-2{grid-template-columns:1fr 1fr}}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;background:var(--btn);color:#fff;font-weight:600;cursor:pointer;transition:.12s transform,.12s filter}
    .btn:hover{transform:translateY(-2px);filter:brightness(.97)}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid rgba(0,0,0,0.06);color:#333;font-size:12px}
    .bar{height:10px;border-radius:999px;background:#eee;overflow:hidden;border:1px solid rgba(0,0,0,0.04)}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#d7e6c7);width:0%}
    .q{margin-top:12px;font-size:18px;color:#222}
    .opt{margin-top:12px;display:grid;gap:10px}
    .opt button{width:100%;text-align:left;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fbfbfb;color:#222;cursor:pointer}
    .opt button.correct{outline:3px solid rgba(34,197,94,0.2);box-shadow:0 4px 14px rgba(34,197,94,0.06)}
    .opt button.wrong{outline:3px solid rgba(239,68,68,0.12);box-shadow:0 4px 14px rgba(239,68,68,0.04)}
    .footer{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-top:14px}
    .small{font-size:13px;color:var(--muted)}
    input[type=text], textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:14px}
    .hidden{display:none}
    /* ป้องกันคลิกขวา */
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screen-intro">
      <div class="row cols-2">
        <div>
          <h1>English Level Test</h1>
          <p class="lead">แบบทดสอบวัดระดับภาษาอังกฤษ — สำหรับเพื่อน ๆ ของชิน (สีพาสเทลตามที่ขอ)</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <label style="display:flex;flex-direction:column;gap:8px">
              ใส่ชื่อ
              <input id="playerName" type="text" placeholder="เช่น: Mind, Fluke" />
            </label>
            <label style="display:flex;flex-direction:column;gap:8px">
              จำนวนข้อที่จะสุ่ม
              <select id="questionCount"></select>
            </label>
          </div><div style="margin-top:12px;display:flex;gap:12px;align-items:center">
        <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="useTimer"> ใช้ตัวจับเวลา (30 วินาที/ข้อ)</label>
        <span class="pill" id="totalTime">—</span>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="startBtn">เริ่มทำแบบทดสอบ</button>
      </div>
      <p class="small" style="margin-top:10px">* โจทย์ถูกฝังไว้ในหน้าเว็บและไม่สามารถแก้ไขได้โดยผู้เล่น</p>
    </div>
    <div>
      <div class="card">
        <div style="display:grid;gap:10px">
          <div><span class="pill">ระดับคะแนน (โดยประมาณ)</span></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div>
              <div>0–24%: <strong>A1</strong></div>
              <div>25–44%: <strong>A2</strong></div>
            </div>
            <div>
              <div>45–59%: <strong>B1</strong></div>
              <div>60–74%: <strong>B2</strong></div>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div>75–89%: <strong>C1</strong></div>
            <div>90–100%: <strong>C2</strong></div>
          </div>
          <div class="small">* คะแนนคำนวณจากข้อที่ตรวจอัตโนมัติ (Multiple choice / short answer)</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card hidden" id="screen-quiz">
  <div class="footer">
    <div class="pill">ชื่อ: <span id="showName">—</span></div>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="pill">ข้อ <span id="curIndex">1</span>/<span id="totalQ">1</span></div>
      <div class="pill">คะแนน <span id="score">0</span></div>
      <div class="pill" id="timerPill" title="เวลาที่เหลือ">⏱ <span id="timeLeft">30</span>s</div>
    </div>
  </div>
  <div class="bar" style="margin:10px 0 6px"><span id="progress"></span></div>
  <div class="q" id="questionText">—</div>
  <div class="opt" id="options"></div>
  <div class="footer">
    <div class="small" id="feedback">เลือกคำตอบ…</div>
    <div style="display:flex;gap:8px">
      <button class="btn" id="nextBtn">ข้อต่อไป ▶</button>
    </div>
  </div>
</div>

<div class="card hidden" id="screen-result">
  <h2 style="margin:4px 0">ผลการทดสอบ</h2>
  <p class="lead">นี่คือผลโดยประมาณของคุณ (ระบบตรวจอัตโนมัติ)</p>
  <div style="display:grid;grid-template-columns:1fr;gap:12px">
    <div class="card">
      <div>
        <div class="pill">ผู้ทำแบบทดสอบ</div>
        <h3 id="rName">—</h3>
        <div class="pill">คะแนน (อัตโนมัติ)</div>
        <h3 id="rScore">0/0</h3>
        <div class="pill">ระดับ (โดยประมาณ)</div>
        <h2 id="rLevel">—</h2>
        <div class="small" id="rTips">—</div>
        <div class="small" id="manualNote" style="margin-top:8px;color:#555"></div>
      </div>
    </div>
    <div class="card">
      <h3 style="margin-top:0">จัดการผลลัพธ์</h3>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="saveCsv">บันทึกเป็น CSV</button>
        <button class="btn ghost" id="retryBtn">เริ่มใหม่</button>
      </div>
      <p class="small" style="margin-top:10px">* ผลจะถูกเก็บชั่วคราวในเบราว์เซอร์เครื่องนั้น</p>
      <div id="historyBox" class="small" style="margin-top:10px"></div>
    </div>
  </div>
</div>

  </div>  <script>
    // ====== คำถาม (B1 - C2) ======
    const defaultQuestions = [
      /* B1 (15 ข้อ) */
      { q:"If it ___ tomorrow, we will cancel the picnic.", choices:["rains","rained","raining"], answer:0, tag:"B1" },
      { q:"Which word means \"a journey by sea\"?", choices:["voyage","flight","trip"], answer:0, tag:"B1" },
      { q:"Why is Tom excited?\nText: Tom is planning to visit London next summer. He has already booked his flight and hotel. He is very excited because he has never been to England before.", answer:"Because he has never been to England before.", tag:"B1" },
      { q:"I have lived in this city ___ five years.", choices:["since","for","at"], answer:1, tag:"B1" },
      { q:"What is the opposite of \"borrow\"?", answer:"lend", tag:"B1" },
      { q:"She is interested ___ learning French.", choices:["in","on","at"], answer:0, tag:"B1" },
      { q:"Where are you?\nListening Text: \"Please leave your message after the beep.\"", answer:"answering machine", tag:"B1" },
      { q:"What will the weather be like tomorrow?\nText: The weather forecast says it will be sunny tomorrow.", answer:"sunny", tag:"B1" },
      { q:"He usually ___ to the gym after work.", choices:["goes","go","going"], answer:0, tag:"B1" },
      { q:"What do you call a person who works in a hospital and helps doctors?", answer:"nurse", tag:"B1" },
      { q:"If I ___ enough money, I would buy a new phone.", choices:["have","had","having"], answer:1, tag:"B1" },
      { q:"Can you go shopping on Sunday?\nText: The shop is open from Monday to Saturday but closed on Sunday.", answer:"no", tag:"B1" },
      { q:"Find a synonym of \"happy\".", answer:"glad", tag:"B1" },
      { q:"I’m not used ___ in such cold weather.", choices:["live","living","to live"], answer:1, tag:"B1" },
      { q:"Describe your favorite holiday. Where did you go and what did you do?", manual:true, tag:"B1" },

      /* B2 (10 ข้อ) */
      { q:"If she had studied harder, she ___ the exam.", choices:["passed","would have passed","will pass"], answer:1, tag:"B2" },
      { q:"The company is trying to reduce its carbon ___.", choices:["footsteps","footprint","fingerprints"], answer:1, tag:"B2" },
      { q:"Did the concert get cancelled?\nText: Despite the rain, the concert went ahead as planned and the audience seemed to enjoy it.", answer:"no", tag:"B2" },
      { q:"I wish I ___ more time to finish the project.", choices:["have","had","having"], answer:1, tag:"B2" },
      { q:"A person who speaks two languages fluently is called a ___.", answer:"bilingual", tag:"B2" },
      { q:"I will keep you informed ___ any changes.", choices:["about","on","to"], answer:0, tag:"B2" },
      { q:"What is a possible disadvantage of online shopping?\nText: Online shopping is convenient, but it can lead to impulse buying.", answer:"impulse buying", tag:"B2" },
      { q:"What’s another word for \"complicated\"?", answer:"complex", tag:"B2" },
      { q:"The new manager wants the team ___ more efficiently.", choices:["to work","work","working"], answer:0, tag:"B2" },
      { q:"Discuss the advantages and disadvantages of social media.", manual:true, tag:"B2" },

      /* C1 (3 ข้อ) */
      { q:"The scientist’s theory was initially met with ___, but later accepted.", choices:["skepticism","approval","enthusiasm"], answer:0, tag:"C1" },
      { q:"How do critics feel about the policy’s long-term impact?\nText: While the policy may seem beneficial in the short term, critics argue that its long-term effects could be detrimental to the economy.", answer:"critics think the policy could harm the economy in the long term", tag:"C1" },
      { q:"Explain how technology has changed education in the past 20 years.", manual:true, tag:"C1" },

      /* C2 (3 ข้อ) */
      { q:"Her speech was so compelling that even her opponents found themselves nodding in agreement.\nQuestion: What can you infer about her speaking skills?", answer:"she is extremely persuasive and articulate", tag:"C2" },
      { q:"Governments should prioritize environmental protection over economic growth.\nSample Answer: Although economic development is important, prioritizing environmental protection ensures long-term sustainability. Without a healthy environment, economic growth cannot be maintained. Governments must balance growth with ecological preservation.", manual:true, tag:"C2" },
      { q:"Create a complex sentence about globalization’s impact on culture.", manual:true, tag:"C2" }
    ];

    // ====== state ======
    const state = {
      allQuestions: defaultQuestions,
      order: [], idx: 0, score: 0, name: '', useTimer:false, secs:30, timer:null,
      pickCount: 10, startedAt: null, history: JSON.parse(localStorage.getItem('quizHistory')||'[]')
    };

    // ====== helpers ======
    const $ = sel => document.querySelector(sel);
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }

    function updateQuestionCountOptions(){
      const sel = $('#questionCount'); sel.innerHTML='';
      const max = state.allQuestions.length;
      [5,8,10,12,15, max].filter(x=>x<=max).forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent = n===max?`${n} (ทั้งหมด)`:n; sel.appendChild(o); });
      sel.value = Math.min(10,max); updateTotalTime();
    }
    function updateTotalTime(){ const cnt = Number($('#questionCount').value); const sec = $('#useTimer').checked ? 30*cnt : 0; $('#totalTime').textContent = $('#useTimer').checked ? `เวลารวม ~ ${Math.ceil(sec/60)} นาที` : 'ปิดตัวจับเวลา'; }
     
    document.addEventListener('DOMContentLoaded', () => {
    updateQuestionCountOptions();
});
    function normalizeText(s){ return String(s||'').toLowerCase().replace(/[\p{P}\p{S}]/gu,'').trim(); }

    function isAutoGradable(q){ return !q.manual; }

    function renderQuiz(){
      const qobj = state.allQuestions[state.order[state.idx]];
      $('#questionText').textContent = qobj.q;
      $('#curIndex').textContent = state.idx+1;
      $('#totalQ').textContent = state.order.length;
      $('#score').textContent = state.score;
      $('#feedback').textContent = 'เลือกคำตอบ…';
      const ops = $('#options'); ops.innerHTML = '';

      if(Array.isArray(qobj.choices)){
        qobj.choices.forEach((c,i)=>{ const b=document.createElement('button'); b.textContent = c; b.onclick=()=>choose(i,b,qobj.answer); ops.appendChild(b); });
      } else if(qobj.manual){
        const ta = document.createElement('textarea'); ta.placeholder = 'พิมพ์คำตอบของคุณที่นี่ (คำตอบต้องตรวจด้วยตนเอง)'; ta.style.minHeight='140px'; ops.appendChild(ta);
        const done = document.createElement('button'); done.className='btn'; done.textContent='ทำเครื่องหมายว่าเสร็จแล้ว'; done.onclick = ()=>{ $('#feedback').textContent='คำตอบนี้ต้องตรวจด้วยตนเอง'; $('#nextBtn').disabled=false; stopTick(); }; ops.appendChild(done);
      } else {
        const inp = document.createElement('input'); inp.type='text'; inp.placeholder='พิมพ์คำตอบสั้น ๆ'; ops.appendChild(inp);
        const sub = document.createElement('button'); sub.className='btn'; sub.textContent='ส่งคำตอบ'; sub.onclick = ()=>{
          const user = normalizeText(inp.value);
          const correct = normalizeText(qobj.answer);
          const opsButtons = Array.from(document.querySelectorAll('#options button'));
          if(user === correct){ state.score++; $('#feedback').textContent='ถูกต้อง!'; }
          else{ $('#feedback').textContent=`คำตอบที่ถูกต้อง: ${qobj.answer}`; }
          $('#score').textContent = state.score; $('#nextBtn').disabled=false; stopTick();
        }; ops.appendChild(sub);
      }

      $('#progress').style.width = `${(state.idx/state.order.length)*100}%`;
      $('#nextBtn').disabled = true;
      if(state.useTimer){ startTick(); }
    }

    function choose(i,btn,correct){
      const ops = Array.from(document.querySelectorAll('#options button'));
      ops.forEach(b=>b.disabled=true);
      if(i===correct){ btn.classList.add('correct'); state.score++; $('#feedback').textContent='ถูกต้อง!'; }
      else { btn.classList.add('wrong'); if(ops[correct]) ops[correct].classList.add('correct'); $('#feedback').textContent='ยังไม่ใช่ ลองข้อต่อไปนะ'; }
      $('#score').textContent = state.score; $('#nextBtn').disabled = false; stopTick();
    }

    function startTick(){ stopTick(); let left = state.secs; $('#timeLeft').textContent = left; $('#timerPill').style.display='inline-flex'; state.timer = setInterval(()=>{ left--; $('#timeLeft').textContent = left; if(left<=0){ stopTick(); autoNext(); } },1000); }
    function stopTick(){ if(state.timer){ clearInterval(state.timer); state.timer=null; } }
    function autoNext(){ const qobj = state.allQuestions[state.order[state.idx]]; if(Array.isArray(qobj.choices)){ const ops = Array.from(document.querySelectorAll('#options button')); ops.forEach(b=>b.disabled=true); if(ops[qobj.answer]) ops[qobj.answer].classList.add('correct'); $('#feedback').textContent='หมดเวลา! ข้อต่อไปนะ'; } else if(!qobj.manual){ $('#feedback').textContent='หมดเวลา! ข้อต่อไปนะ (คำตอบถือว่าผิด)'; } else { $('#feedback').textContent='หมดเวลา! คำตอบนี้ต้องตรวจด้วยตนเอง'; } $('#nextBtn').disabled=false; }

    function nextQuestion(){ state.idx++; if(state.idx >= state.order.length){ return finish(); } renderQuiz(); }

    function levelFrom(score,total){ if(total === 0) return {label:'N/A', tips:'ไม่มีคำถามที่ตรวจอัตโนมัติให้ประเมิน'}; const pct = (score/total)*100; if(pct >= 90) return {label:'C2', tips:'การใช้ภาษาระดับสูงมาก'}; if(pct >= 75) return {label:'C1', tips:'สื่อสารเชิงซับซ้อนได้ดี'}; if(pct >= 60) return {label:'B2', tips:'สื่อสารได้มั่นใจในสถานการณ์ทั่วไป'}; if(pct >= 45) return {label:'B1', tips:'พื้นฐานดี ใช้ภาษาในชีวิตประจำวันได้'}; if(pct >= 25) return {label:'A2', tips:'เริ่มใช้ภาษาได้ในสถานการณ์ง่ายๆ'}; return {label:'A1', tips:'ควรฝึกพื้นฐานเพิ่มเติม'}; }

    function finish(){ hide('screen-quiz'); show('screen-result');
      // คำนวณจากข้อที่ตรวจอัตโนมัติ
      const totalAuto = state.order.reduce((s,i)=> s + (isAutoGradable(state.allQuestions[i])?1:0), 0);
      const {label,tips} = levelFrom(state.score, totalAuto);
      $('#rName').textContent = state.name || '-';
      $('#rScore').textContent = `${state.score}/${totalAuto}`;
      $('#rLevel').textContent = label; $('#rTips').textContent = tips;
      const manualCount = state.order.reduce((s,i)=> s + (state.allQuestions[i].manual?1:0), 0);
      $('#manualNote').textContent = manualCount ? `มี ${manualCount} ข้อที่ต้องตรวจด้วยตนเอง (คำถามเชิงอธิบาย)` : '';
      const rec = { name: state.name||'-', score: state.score, total: totalAuto, level: label, at: new Date().toISOString() };
      state.history.unshift(rec); state.history = state.history.slice(0,50); localStorage.setItem('quizHistory', JSON.stringify(state.history)); renderHistory();
    }

    function renderHistory(){ const box = $('#historyBox'); if(!state.history.length){ box.innerHTML = '<span class="small">ยังไม่มีประวัติ</span>'; return; } const items = state.history.map(h=>`<div style="display:inline-block;margin:4px 6px;padding:6px 10px;background:#fafafa;border-radius:10px;border:1px solid rgba(0,0,0,0.04);color:#333">${h.name} • ${h.score}/${h.total} • ${h.level}</div>`).join(''); box.innerHTML = `<div class="small">ประวัติล่าสุด:</div>${items}`; }

    // ====== UI helpers ======
    function show(id){ document.getElementById(id).classList.remove('hidden'); }
    function hide(id){ document.getElementById(id).classList.add('hidden'); }

    // ====== init ======
    $('#startBtn').onclick = ()=>{
      state.name = $('#playerName').value.trim(); state.useTimer = $('#useTimer').checked; state.pickCount = Number($('#questionCount').value);
      const idxs = Array.from({length: state.allQuestions.length}, (_,i)=>i);
      state.order = shuffle(idxs).slice(0, state.pickCount);
      state.idx = 0; state.score = 0; state.startedAt = new Date();
      hide('screen-intro'); hide('screen-result'); show('screen-quiz');
      $('#showName').textContent = state.name || '-'; renderQuiz();
    };

    $('#nextBtn').onclick = nextQuestion;
    $('#retryBtn').onclick = ()=>{ hide('screen-result'); show('screen-intro'); };

    $('#saveCsv').onclick = ()=>{
      const rows = [['name','score','total','level','timestamp'], ...state.history.map(h=>[h.name,h.score,h.total,h.level,h.at])];
      const csv = rows.map(r=>r.map(v=>`"${String(v).replaceAll('"','""')}"`).join(',')).join('
');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='english-level-results.csv'; a.click(); URL.revokeObjectURL(url);
    };

    updateQuestionCountOptions(); renderHistory();

    // ====== ป้องกันการคัดลอก/คลิกขวา ======
    document.addEventListener('copy', function(e){ e.preventDefault(); });
    document.addEventListener('cut', function(e){ e.preventDefault(); });
    document.addEventListener('contextmenu', function(e){ e.preventDefault();
